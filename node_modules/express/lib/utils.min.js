/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 *//**
 * Module dependencies.
 * @api private
 */function paramsEqual(e,t){return!Object.keys(e).some(function(n){return e[n]!=t[n]})}function acceptParams(e,t){var n=e.split(/ *; */),r={value:n[0],quality:1,params:{},originalIndex:t};for(var i=1;i<n.length;++i){var s=n[i].split(/ *= */);"q"==s[0]?r.quality=parseFloat(s[1]):r.params[s[0]]=s[1]}return r}var contentType=require("content-type"),etag=require("etag"),mime=require("connect").mime,proxyaddr=require("proxy-addr"),toString={}.toString;exports.etag=function(e,t){var n=Buffer.isBuffer(e)?e:new Buffer(e,t);return etag(n,{weak:!1})};exports.wetag=function(t,n){var r=Buffer.isBuffer(t)?t:new Buffer(t,n);return etag(r,{weak:!0})};exports.locals=function(){function e(t){for(var n in t)e[n]=t[n];return t}return e};exports.isAbsolute=function(e){if("/"==e[0])return!0;if(":"==e[1]&&"\\"==e[2])return!0;if("\\\\"==e.substring(0,2))return!0};exports.flatten=function(e,t){var t=t||[],n=e.length;for(var r=0;r<n;++r)Array.isArray(e[r])?exports.flatten(e[r],t):t.push(e[r]);return t};exports.normalizeType=function(e){return~e.indexOf("/")?acceptParams(e):{value:mime.lookup(e),params:{}}};exports.normalizeTypes=function(e){var t=[];for(var n=0;n<e.length;++n)t.push(exports.normalizeType(e[n]));return t};exports.acceptsArray=function(e,t){if(!t)return e[0];var n=exports.parseAccept(t),r=exports.normalizeTypes(e),i=n.length;for(var s=0;s<i;++s)for(var o=0,u=e.length;o<u;++o)if(exports.accept(r[o],n[s]))return e[o]};exports.accepts=function(e,t){"string"==typeof e&&(e=e.split(/ *, */));return exports.acceptsArray(e,t)};exports.accept=function(e,t){var n=e.value.split("/");return(n[0]==t.type||"*"==t.type)&&(n[1]==t.subtype||"*"==t.subtype)&&paramsEqual(e.params,t.params)};exports.parseAccept=function(e){return exports.parseParams(e).map(function(e){var t=e.value.split("/");e.type=t[0];e.subtype=t[1];return e})};exports.parseParams=function(e){return e.split(/ *, */).map(acceptParams).filter(function(e){return e.quality}).sort(function(e,t){return e.quality===t.quality?e.originalIndex-t.originalIndex:t.quality-e.quality})};exports.pathRegexp=function(e,t,n,r){if(toString.call(e)=="[object RegExp]")return e;Array.isArray(e)&&(e="("+e.join("|")+")");e=e.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g,function(e,n,r,i,s,o,u){t.push({name:i,optional:!!o});n=n||"";return""+(o?"":n)+"(?:"+(o?n:"")+(r||"")+(s||r&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")+(u?"(/*)?":"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)");return new RegExp("^"+e+"$",n?"":"i")};exports.compileETag=function(e){var t;if(typeof e=="function")return e;switch(e){case!0:t=exports.wetag;break;case!1:break;case"strong":t=exports.etag;break;case"weak":t=exports.wetag;break;default:throw new TypeError("unknown value for etag function: "+e)}return t};exports.compileTrust=function(e){if(typeof e=="function")return e;if(e===!0)return function(){return!0};if(typeof e=="number")return function(t,n){return n<e};typeof e=="string"&&(e=e.split(/ *, */));return proxyaddr.compile(e||[])};exports.setCharset=function(t,n){if(!t||!n)return t;var r=contentType.parse(t);r.parameters.charset=n;return contentType.format(r)};
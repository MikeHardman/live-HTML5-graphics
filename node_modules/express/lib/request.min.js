/**
 * Module dependencies.
 */var auth=require("basic-auth"),deprecate=require("depd")("express"),http=require("http"),utils=require("./utils"),connect=require("connect"),fresh=require("fresh"),parseRange=require("range-parser"),parse=require("parseurl"),proxyaddr=require("proxy-addr"),mime=connect.mime,isIP=require("net").isIP,req=exports=module.exports={__proto__:http.IncomingMessage.prototype};req.get=req.header=function(e){switch(e=e.toLowerCase()){case"referer":case"referrer":return this.headers.referrer||this.headers.referer;default:return this.headers[e]}};req.accepts=function(e){var t=arguments.length>1?[].slice.apply(arguments):e;return utils.accepts(t,this.get("Accept"))};req.acceptsEncoding=function(e){return!!~this.acceptedEncodings.indexOf(e)};req.acceptsCharset=function(e){var t=this.acceptedCharsets;return t.length?!!~t.indexOf(e):!0};req.acceptsLanguage=function(e){var t=this.acceptedLanguages;return t.length?!!~t.indexOf(e):!0};req.range=function(e){var t=this.get("Range");if(!t)return;return parseRange(e,t)};req.__defineGetter__("acceptedEncodings",function(){var e=this.get("Accept-Encoding");return e?e.trim().split(/ *, */):[]});req.__defineGetter__("accepted",function(){var e=this.get("Accept");return e?utils.parseAccept(e):[]});req.__defineGetter__("acceptedLanguages",function(){var e=this.get("Accept-Language");return e?utils.parseParams(e).map(function(e){return e.value}):[]});req.__defineGetter__("acceptedCharsets",function(){var e=this.get("Accept-Charset");return e?utils.parseParams(e).map(function(e){return e.value}):[]});req.param=function(e,t){var n=this.params||{},r=this.body||{},i=this.query||{};return null!=n[e]&&n.hasOwnProperty(e)?n[e]:null!=r[e]?r[e]:null!=i[e]?i[e]:t};req.is=function(e){var t=this.get("Content-Type");if(!t)return!1;t=t.split(";")[0];~e.indexOf("/")||(e=mime.lookup(e));if(~e.indexOf("*")){e=e.split("/");t=t.split("/");return"*"==e[0]&&e[1]==t[1]?!0:"*"==e[1]&&e[0]==t[0]?!0:!1}return!!~t.indexOf(e)};req.__defineGetter__("protocol",function(){var e=this.connection.encrypted?"https":"http",t=this.app.get("trust proxy fn");if(!t(this.connection.remoteAddress,0))return e;e=this.get("X-Forwarded-Proto")||e;return e.split(/\s*,\s*/)[0]});req.__defineGetter__("secure",function(){return"https"==this.protocol});req.__defineGetter__("ip",function(){var e=this.app.get("trust proxy fn");return proxyaddr(this,e)});req.__defineGetter__("ips",function(){var e=this.app.get("trust proxy fn"),t=proxyaddr.all(this,e);return t.slice(1).reverse()});req.__defineGetter__("auth",function(){deprecate("req.auth: Use basic-auth npm module instead");var e=auth(this);if(!e)return;return{username:e.name,password:e.pass}});req.__defineGetter__("subdomains",function(){var e=this.host;if(!e)return[];var t=this.app.get("subdomain offset"),n=isIP(e)?[e]:e.split(".").reverse();return n.slice(t)});req.__defineGetter__("path",function(){return parse(this).pathname});req.__defineGetter__("host",function(){var e=this.app.get("trust proxy fn"),t=this.get("X-Forwarded-Host");if(!t||!e(this.connection.remoteAddress,0))t=this.get("Host");if(!t)return;var n=t[0]==="["?t.indexOf("]")+1:0,r=t.indexOf(":",n);return~r?t.substring(0,r):t});req.__defineGetter__("fresh",function(){var e=this.method,t=this.res.statusCode;return"GET"!=e&&"HEAD"!=e?!1:t>=200&&t<300||304==t?fresh(this.headers,this.res._headers||{}):!1});req.__defineGetter__("stale",function(){return!this.fresh});req.__defineGetter__("xhr",function(){var e=this.get("X-Requested-With")||"";return"xmlhttprequest"==e.toLowerCase()});
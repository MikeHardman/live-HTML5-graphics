/*!
 * content-type
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 *//**
 * RegExp to match *( ";" parameter ) in RFC 7231 sec 3.1.1.1
 *
 * parameter     = token "=" ( token / quoted-string )
 * token         = 1*tchar
 * tchar         = "!" / "#" / "$" / "%" / "&" / "'" / "*"
 *               / "+" / "-" / "." / "^" / "_" / "`" / "|" / "~"
 *               / DIGIT / ALPHA
 *               ; any VCHAR, except delimiters
 * quoted-string = DQUOTE *( qdtext / quoted-pair ) DQUOTE
 * qdtext        = HTAB / SP / %x21 / %x23-5B / %x5D-7E / obs-text
 * obs-text      = %x80-FF
 * quoted-pair   = "\" ( HTAB / SP / VCHAR / obs-text )
 */function format(e){if(!e||typeof e!="object")throw new TypeError("argument obj is required");var t=e.parameters,n=e.type;if(!n||!typeRegExp.test(n))throw new TypeError("invalid type");var r=n;if(t&&typeof t=="object"){var i,s=Object.keys(t).sort();for(var o=0;o<s.length;o++){i=s[o];if(!tokenRegExp.test(i))throw new TypeError("invalid parameter name");r+="; "+i+"="+qstring(t[i])}}return r}function parse(e){if(!e)throw new TypeError("argument string is required");if(typeof e=="object"){e=getcontenttype(e);if(typeof e!="string")throw new TypeError("content-type header is missing from object")}if(typeof e!="string")throw new TypeError("argument string is required to be a string");var t=e.indexOf(";"),n=t!==-1?e.substr(0,t).trim():e.trim();if(!typeRegExp.test(n))throw new TypeError("invalid media type");var r,i,s=new ContentType(n.toLowerCase()),o;paramRegExp.lastIndex=t;while(i=paramRegExp.exec(e)){if(i.index!==t)throw new TypeError("invalid parameter format");t+=i[0].length;r=i[1].toLowerCase();o=i[2];o[0]==='"'&&(o=o.substr(1,o.length-2).replace(qescRegExp,"$1"));s.parameters[r]=o}if(t!==-1&&t!==e.length)throw new TypeError("invalid parameter format");return s}function getcontenttype(e){if(typeof e.getHeader=="function")return e.getHeader("content-type");if(typeof e.headers=="object")return e.headers&&e.headers["content-type"]}function qstring(e){var t=String(e);if(tokenRegExp.test(t))return t;if(t.length>0&&!textRegExp.test(t))throw new TypeError("invalid parameter value");return'"'+t.replace(quoteRegExp,"\\$1")+'"'}function ContentType(e){this.parameters=Object.create(null);this.type=e}var paramRegExp=/; *([!#$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+) *= *("(?:[\u000b\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u000b\u0020-\u00ff])*"|[!#$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+) */g,textRegExp=/^[\u000b\u0020-\u007e\u0080-\u00ff]+$/,tokenRegExp=/^[!#$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+$/,qescRegExp=/\\([\u000b\u0020-\u00ff])/g,quoteRegExp=/([\\"])/g,typeRegExp=/^[!#$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+\/[!#$%&'\*\+\-\.\^_`\|~0-9A-Za-z]+$/;exports.format=format;exports.parse=parse;